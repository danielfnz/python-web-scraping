import requests
import pandas as pd
from bs4 import BeautifulSoup
import json
import re
import firebase_admin
from firebase_admin import credentials
from firebase_admin import db

cred = credentials.Certificate("firebaseAdmin.json")
firebase_admin.initialize_app(cred, {
    'databaseURL': 'https://easypet-dev.firebaseio.com'
})

SUPERHEROES = db.reference('produtos')

# Coletar e analisar a primeira p√°gina
page = requests.get('https://www.petlove.com.br/marcas')
soup = BeautifulSoup(page.text, 'html.parser')

# Pegar todo o texto da div BodyText
artist_name_list = soup.findAll(class_='static-list-box')
for index, artist_name in enumerate(artist_name_list, start=0):
    artist_name_list_items = artist_name.find_all('a')
    for artist_name in artist_name_list_items:
        links = 'https://www.petlove.com.br' + artist_name.get('href')
        page2 = requests.get(links)
        JSON = re.compile('catalogJSON = ({.*?});', re.DOTALL)

        matches = JSON.search(page2.text)
        if matches:
            categoria = json.loads(matches.group(1))
            if categoria["produtos"]:
                for produto in categoria["produtos"]:
                    if produto:
                        SUPERHEROES.push(produto)
